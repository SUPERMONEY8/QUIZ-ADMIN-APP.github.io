# File Storage System Documentation

## Overview
This file storage system provides a complete solution for reading/writing JSON files from the user's AppData directory in a Tauri desktop application.

## Features
- ✅ Read/write JSON files from AppData directory
- ✅ Sheet data structure with employees, vacation days, work history
- ✅ Initialize default data if missing
- ✅ Functions: `loadSheet()`, `saveSheet()`, `updateWorkDay()`
- ✅ Comprehensive error handling for file operations
- ✅ Uses Tauri's `invoke()` for file operations
- ✅ Fallback to localStorage when Tauri API is not available

## Data Structure

### SheetData
```javascript
{
    employees: [
        {
            id: "emp_001",
            name: "أحمد محمد",
            position: "موظف",
            department: "المبيعات"
        }
    ],
    vacation_days: [
        {
            employee_id: "emp_001",
            date: "2024-01-15",
            reason: "إجازة سنوية"
        }
    ],
    work_history: [
        {
            employee_id: "emp_001",
            date: "2024-01-10",
            hours: 8.0,
            shift: "Morning"
        }
    ]
}
```

## API Functions

### `loadSheet(sheetIndex)`
Loads sheet data from file. Returns default data if file doesn't exist.

**Parameters:**
- `sheetIndex` (number): Index of the sheet (0-based)

**Returns:**
- `Promise<SheetData>`: Sheet data object

**Example:**
```javascript
const data = await window.SheetStorage.loadSheet(0);
console.log(data.employees);
```

### `saveSheet(sheetIndex, data)`
Saves sheet data to file.

**Parameters:**
- `sheetIndex` (number): Index of the sheet (0-based)
- `data` (SheetData): Sheet data object to save

**Returns:**
- `Promise<boolean>`: Success status

**Example:**
```javascript
const data = {
    employees: [...],
    vacation_days: [...],
    work_history: [...]
};
await window.SheetStorage.saveSheet(0, data);
```

### `updateWorkDay(sheetIndex, workDay)`
Updates or adds a work day entry.

**Parameters:**
- `sheetIndex` (number): Index of the sheet (0-based)
- `workDay` (WorkDay): Work day object

**Returns:**
- `Promise<boolean>`: Success status

**Example:**
```javascript
await window.SheetStorage.updateWorkDay(0, {
    employee_id: "emp_001",
    date: "2024-01-10",
    hours: 8.0,
    shift: "Morning"
});
```

### `addEmployee(sheetIndex, employee)`
Adds a new employee to the sheet.

**Parameters:**
- `sheetIndex` (number): Index of the sheet (0-based)
- `employee` (Employee): Employee object

**Example:**
```javascript
await window.SheetStorage.addEmployee(0, {
    id: "emp_003",
    name: "محمد علي",
    position: "موظف",
    department: "التسويق"
});
```

### `addVacationDay(sheetIndex, vacationDay)`
Adds a vacation day entry.

**Parameters:**
- `sheetIndex` (number): Index of the sheet (0-based)
- `vacationDay` (VacationDay): Vacation day object

**Example:**
```javascript
await window.SheetStorage.addVacationDay(0, {
    employee_id: "emp_001",
    date: "2024-01-15",
    reason: "إجازة سنوية"
});
```

## Error Handling

All functions include comprehensive error handling:
- File read/write errors are caught and logged
- Invalid data structures are validated
- Default data is returned if files don't exist
- Errors are thrown with descriptive messages

## File Location

Files are stored in the user's AppData directory:
- **Windows**: `%APPDATA%\com.khifara.g\`
- **macOS**: `~/Library/Application Support/com.khifara.g/`
- **Linux**: `~/.local/share/com.khifara.g/`

Files are named: `sheet_0.json`, `sheet_1.json`, etc.

## Usage in HTML

The storage system is automatically loaded and available via `window.SheetStorage`:

```html
<script src="storage.js"></script>
<script>
    // Use the storage functions
    const data = await window.SheetStorage.loadSheet(0);
    await window.SheetStorage.saveSheet(0, data);
</script>
```

## Rust Backend

The Rust backend provides three Tauri commands:
1. `read_sheet_file` - Reads JSON file from AppData
2. `write_sheet_file` - Writes JSON file to AppData
3. `update_work_day` - Updates a work day entry

All commands handle errors gracefully and return default data if files don't exist.

