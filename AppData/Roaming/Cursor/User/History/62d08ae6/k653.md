# Supabase Setup Guide

This guide will help you set up your Supabase database for the Quiz App.

## Step 1: Run the SQL Migration

1. Go to your Supabase Dashboard: https://supabase.com/dashboard
2. Select your project
3. Go to **SQL Editor** (left sidebar)
4. Click **New Query**
5. Copy and paste the entire contents of `supabase-setup.sql`
6. Click **Run** (or press Ctrl+Enter)

This will create all the necessary tables, indexes, and security policies.

## Step 2: Configure Authentication

1. In Supabase Dashboard, go to **Authentication** → **Providers**
2. Make sure **Email** provider is enabled
3. (Optional) Configure email templates for:
   - Sign up confirmation
   - Password reset
   - Magic link

## Step 3: Configure Email Settings (Optional but Recommended)

1. Go to **Authentication** → **Settings**
2. Under **Email Auth**, configure:
   - **Enable email confirmations**: Toggle based on your preference
     - If enabled: Users must confirm email before logging in
     - If disabled: Users can log in immediately after signup
3. Add your site URLs to **Redirect URLs**:
   - For local development: `http://localhost:5173/auth/callback`
   - For production: `https://your-domain.com/auth/callback`
   - For Vercel: `https://your-app.vercel.app/auth/callback`

## Step 4: Verify Tables Were Created

1. Go to **Table Editor** (left sidebar)
2. You should see these tables:
   - `admins`
   - `quizzes`
   - `questions`
   - `results`
   - `question_attempts`

## Step 5: Test Authentication

1. Try creating an account in your app
2. Check **Authentication** → **Users** in Supabase to see if the user was created
3. If email confirmation is enabled, check the user's email for confirmation link

## Troubleshooting

### "Failed to fetch" error persists
- Make sure your `.env` file has the correct credentials
- Restart your development server after creating `.env`
- Check browser console for specific error messages

### "Permission denied" errors
- Make sure you ran the SQL migration completely
- Check that RLS policies were created (go to **Authentication** → **Policies`)
- Verify the user is authenticated when trying to access protected data

### Email confirmation not working
- Check **Authentication** → **Settings** → **Redirect URLs**
- Make sure your callback URL is added
- Check spam folder for confirmation emails

## Database Schema Overview

### `admins`
- Stores admin user profiles
- Linked to `auth.users` via `id`

### `quizzes`
- Stores quiz information
- Fields: title, description, duration, status, etc.
- Linked to admin via `admin_id`

### `questions`
- Stores quiz questions
- Supports multiple choice, true/false, and short answer
- Linked to quiz via `quiz_id`

### `results`
- Stores quiz attempt results
- Tracks participant name, score, time spent
- Linked to quiz via `quiz_id`

### `question_attempts`
- Stores individual question attempts
- Tracks user answers and correctness
- Linked to question and result

## Security Notes

- Row Level Security (RLS) is enabled on all tables
- Admins can only access their own quizzes and data
- Participants can read published quizzes and create results
- All policies are defined in the SQL migration

## Next Steps

After setup:
1. Create your first admin account through the app
2. The admin account will automatically create an entry in the `admins` table
3. Start creating quizzes through the admin interface
4. Share quiz links with participants

