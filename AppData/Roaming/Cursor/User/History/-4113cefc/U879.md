# Configuration Multi-Tenant - Support de Plusieurs Utilisateurs

## ğŸ¯ Vue d'Ensemble

Le systÃ¨me est maintenant configurÃ© pour supporter **des centaines ou milliers d'utilisateurs**, chacun avec :
- âœ… Ses propres quiz
- âœ… Ses propres questions
- âœ… Ses propres rÃ©sultats
- âœ… Son propre nom d'app personnalisÃ©
- âœ… Sa propre palette de couleurs
- âœ… Sa propre icÃ´ne

## ğŸ”’ SÃ©curitÃ© Multi-Tenant

### Protection des DonnÃ©es
- Chaque utilisateur a un **ID unique** gÃ©nÃ©rÃ© automatiquement
- L'API PHP **vÃ©rifie toujours la propriÃ©tÃ©** avant toute opÃ©ration
- Un utilisateur **ne peut pas accÃ©der** aux quiz/questions/rÃ©sultats d'un autre utilisateur
- Toutes les requÃªtes nÃ©cessitent `admin_id` pour la sÃ©curitÃ©

### Table `users`
Une nouvelle table `users` stocke :
- `id` : ID unique de l'utilisateur
- `email` : Email (optionnel)
- `name` : Nom (optionnel)
- `app_name` : Nom de l'app personnalisÃ©
- `color_palette` : Palette de couleurs choisie
- `selected_icon` : IcÃ´ne choisie

## ğŸš€ Fonctionnement

### 1. GÃ©nÃ©ration Automatique d'ID Utilisateur
- Au premier chargement, un ID unique est gÃ©nÃ©rÃ©
- L'ID est stockÃ© dans `localStorage`
- L'ID est crÃ©Ã© dans la base de donnÃ©es MySQL
- Chaque utilisateur a son propre ID, mÃªme sans connexion

### 2. Isolation des DonnÃ©es
- Tous les quiz sont liÃ©s Ã  `admin_id` (ID utilisateur)
- Toutes les questions sont liÃ©es aux quiz (donc indirectement Ã  l'utilisateur)
- Tous les rÃ©sultats sont liÃ©s aux quiz (donc indirectement Ã  l'utilisateur)
- Les requÃªtes SQL utilisent des JOINs pour vÃ©rifier la propriÃ©tÃ©

### 3. API SÃ©curisÃ©e
Chaque endpoint vÃ©rifie :
- âœ… Que l'utilisateur existe
- âœ… Que l'utilisateur est propriÃ©taire des donnÃ©es qu'il modifie
- âœ… Que les requÃªtes incluent `admin_id`

## ğŸ“Š Exemple de DonnÃ©es

### Utilisateur 1 (ID: `user_1234567890_abc123`)
- Quiz: "Quiz de MathÃ©matiques"
- Quiz: "Quiz de Sciences"
- Questions: 50 questions au total
- RÃ©sultats: 200 rÃ©sultats

### Utilisateur 2 (ID: `user_1234567891_xyz789`)
- Quiz: "Quiz de FranÃ§ais"
- Quiz: "Quiz d'Histoire"
- Questions: 30 questions au total
- RÃ©sultats: 150 rÃ©sultats

**Les donnÃ©es sont complÃ¨tement isolÃ©es !**

## ğŸ”§ Configuration

### SchÃ©ma MySQL
Le schÃ©ma inclut maintenant :
- Table `users` pour stocker les utilisateurs
- Contrainte de clÃ© Ã©trangÃ¨re : `quizzes.admin_id` â†’ `users.id`
- Index sur `admin_id` pour de meilleures performances

### API PHP
Tous les endpoints vÃ©rifient la propriÃ©tÃ© :
- `quizzes.php` : VÃ©rifie `admin_id` avant GET/PUT/DELETE
- `questions.php` : VÃ©rifie la propriÃ©tÃ© via JOIN avec `quizzes`
- `results.php` : VÃ©rifie la propriÃ©tÃ© via JOIN avec `quizzes`

### Frontend React
- `userManager.js` : GÃ¨re la gÃ©nÃ©ration et le stockage de l'ID utilisateur
- `mysqlHelpers.js` : Passe toujours `admin_id` dans les requÃªtes
- `App.jsx` : Initialise l'ID utilisateur au dÃ©marrage

## ğŸ“ Migration des DonnÃ©es Existantes

Si vous avez dÃ©jÃ  des donnÃ©es :
1. Chaque utilisateur existant doit avoir un `admin_id` unique
2. Vous pouvez crÃ©er des utilisateurs manuellement dans la table `users`
3. Mettre Ã  jour les `admin_id` dans la table `quizzes` pour les lier aux utilisateurs

## âœ… Test Multi-Tenant

Pour tester :
1. Ouvrez l'app dans un navigateur â†’ Utilisateur 1 crÃ©Ã©
2. CrÃ©ez un quiz â†’ VÃ©rifiez qu'il est liÃ© Ã  l'utilisateur 1
3. Ouvrez l'app dans un autre navigateur (ou mode privÃ©) â†’ Utilisateur 2 crÃ©Ã©
4. CrÃ©ez un quiz â†’ VÃ©rifiez qu'il est liÃ© Ã  l'utilisateur 2
5. VÃ©rifiez que chaque utilisateur ne voit que ses propres quiz

## ğŸ¯ Avantages

1. **ScalabilitÃ©** : Supporte des milliers d'utilisateurs
2. **SÃ©curitÃ©** : Isolation complÃ¨te des donnÃ©es
3. **Performance** : Index sur `admin_id` pour des requÃªtes rapides
4. **FlexibilitÃ©** : Chaque utilisateur peut personnaliser son app
5. **SimplicitÃ©** : Pas besoin d'authentification complexe (ID gÃ©nÃ©rÃ© automatiquement)

## âš ï¸ Notes Importantes

1. **ID Utilisateur** : StockÃ© dans `localStorage`, donc :
   - Si l'utilisateur efface le cache, il obtiendra un nouvel ID
   - Pour un ID permanent, utilisez un email ou un systÃ¨me d'authentification

2. **SÃ©curitÃ© en Production** :
   - Envisagez d'ajouter une authentification (email/mot de passe)
   - Limitez les requÃªtes par IP pour Ã©viter les abus
   - Ajoutez un rate limiting sur l'API

3. **Backup** :
   - Faites rÃ©guliÃ¨rement des sauvegardes de la base de donnÃ©es
   - La table `users` est importante pour la rÃ©cupÃ©ration

