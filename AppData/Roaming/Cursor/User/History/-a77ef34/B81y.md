# Email Confirmation Setup - Complete Guide

## âœ… Code Changes Applied

All code changes have been implemented! Here's what was done:

1. **Created `EmailConfirmationCallback.jsx`** - Handles the redirect from Supabase after email confirmation
2. **Updated `App.jsx`** - Added route for `/auth/callback` 
3. **Updated `useAuth.js`** - Set `emailRedirectTo` to `/auth/callback`
4. **Updated login/signup pages** - Redirect to `/participant/dashboard` after successful auth

## ğŸ”§ Supabase Dashboard Configuration (REQUIRED)

You **MUST** configure this in your Supabase Dashboard for it to work:

### Step 1: Set Site URL

1. Go to **Supabase Dashboard** â†’ Your Project
2. Navigate to **Authentication** â†’ **URL Configuration**
3. Set **Site URL** to your app's URL:
   - **Production:** `https://your-app-domain.com`
   - **Development:** `http://localhost:5173` (or your dev port)

### Step 2: Set Redirect URLs

In the same **URL Configuration** section:

1. Find **"Redirect URLs"** (or "Allowed Redirect URLs")
2. Add these URLs (one per line):
   ```
   http://localhost:5173/auth/callback
   https://your-app-domain.com/auth/callback
   ```
   Replace `your-app-domain.com` with your actual domain.

3. **Save** the changes

### Step 3: Email Confirmation Settings (Optional)

If you want to **disable email confirmation** (for testing):

1. Go to **Authentication** â†’ **Settings**
2. Find **Email Auth** section
3. **Toggle OFF** "Confirm email" 
4. **Save** changes

**Note:** For production, it's recommended to keep email confirmation enabled for security.

## ğŸ“‹ How It Works

### Flow Diagram:

```
1. User signs up
   â†“
2. Supabase sends confirmation email
   â†“
3. User clicks "Confirm your mail" link in email
   â†“
4. Supabase redirects to: https://your-app.com/auth/callback#access_token=...&refresh_token=...
   â†“
5. EmailConfirmationCallback page processes tokens
   â†“
6. User is logged in automatically
   â†“
7. Redirect to /participant/dashboard (quiz selection page)
```

## ğŸ¯ Result

After email confirmation:
- âœ… User is automatically logged in
- âœ… User is redirected to `/participant/dashboard`
- âœ… User can paste quiz links and start quizzes
- âœ… Smooth, seamless experience!

## ğŸ› Troubleshooting

### Issue: "Redirect URL not allowed"

**Solution:** Make sure you added `/auth/callback` to the Redirect URLs in Supabase Dashboard (Step 2 above).

### Issue: User not logged in after confirmation

**Solution:** 
1. Check browser console for errors
2. Verify tokens are in the URL hash (`#access_token=...`)
3. Check that `EmailConfirmationCallback` component is loading

### Issue: Redirects to wrong page

**Solution:** 
- Check that `emailRedirectTo` in `useAuth.js` matches your domain
- Verify the route `/auth/callback` exists in `App.jsx`

### Issue: Email confirmation not working

**Solution:**
1. Check Supabase Dashboard â†’ Authentication â†’ Users
2. Verify the user was created
3. Check if email confirmation is enabled/disabled in settings
4. Check email spam folder for confirmation email

## âœ… Testing Checklist

- [ ] Set Site URL in Supabase Dashboard
- [ ] Add Redirect URLs in Supabase Dashboard
- [ ] Test signup flow
- [ ] Check email for confirmation link
- [ ] Click confirmation link
- [ ] Verify redirect to `/participant/dashboard`
- [ ] Verify user is logged in
- [ ] Test quiz link access

## ğŸ“ Notes

- The callback page (`/auth/callback`) handles the token exchange automatically
- Users are redirected to `/participant/dashboard` where they can choose quizzes
- If email confirmation is disabled, users go directly to dashboard after signup
- All error cases are handled with user-friendly messages

---

**That's it!** Once you configure the Supabase Dashboard settings, the email confirmation flow will work perfectly! ğŸ‰

